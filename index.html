<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Indosphere</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --text-main: #e0e0e0;
            --text-dim: #666;
            --accent: #d4af37; /* Gold */
            --panel-bg: rgba(10, 10, 10, 0.95);
            --border: #222;
        }

        * { box-sizing: border-box; }

        body {
            background: var(--bg);
            color: var(--text-main);
            margin: 0;
            font-family: 'Inter', sans-serif;
            height: 100vh;
            width: 100vw;
            overflow: hidden; 
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER --- */
        header {
            height: 60px;
            flex-shrink: 0;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            z-index: 1000;
        }

        .brand {
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            color: var(--text-main);
            letter-spacing: 2px;
            font-weight: 600;
            cursor: pointer;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        /* Minimal Inputs */
        select, input {
            background: transparent;
            color: var(--text-dim);
            border: 1px solid var(--border);
            padding: 8px 12px;
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            border-radius: 4px;
            outline: none;
            transition: all 0.2s;
        }

        select:hover, input:focus, input:hover {
            border-color: var(--text-dim);
            color: var(--text-main);
        }

        /* Search Dropdown */
        .search-wrapper { position: relative; }
        
        #search-results {
            position: absolute;
            top: 45px; right: 0; width: 240px;
            background: #0f0f0f;
            border: 1px solid var(--border);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            flex-direction: column;
            z-index: 2000;
        }

        .search-item {
            padding: 12px 15px;
            border-bottom: 1px solid #1a1a1a;
            font-size: 0.85rem;
            color: #aaa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            transition: 0.1s;
        }

        .search-item:hover { background: #1a1a1a; color: #fff; }
        .search-item span.meta { font-size: 0.7rem; color: #555; }

        /* --- MAIN CANVAS --- */
        .main-container {
            flex-grow: 1;
            position: relative;
            background: var(--bg);
        }

        #network {
            width: 100%;
            height: 100%;
            outline: none;
        }

        /* --- TIMELINE (Minimal) --- */
        #timeline-container {
            height: 180px;
            background: var(--bg);
            border-top: 1px solid var(--border);
            position: relative;
            z-index: 20;
        }

        #mytimeline { width: 100%; height: 100%; }

        /* Vis.js Timeline Overrides for Minimalism */
        .vis-timeline { border: none !important; }
        .vis-time-axis .vis-grid.vis-minor { border-color: #111 !important; }
        .vis-time-axis .vis-grid.vis-major { border-color: #222 !important; }
        .vis-time-axis .vis-text { color: #444 !important; font-family: 'Inter', sans-serif; font-size: 10px; }
        
        .vis-item.vis-point {
            background: transparent !important;
            border-color: transparent !important;
            color: #777 !important;
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            margin-top: 15px;
            transition: all 0.2s;
        }

        .vis-item.vis-dot {
            border-width: 1px;
            border-color: #444;
            background-color: #000;
            width: 6px; height: 6px;
            top: 2px;
            transition: all 0.2s;
        }

        .vis-item.vis-point:hover { color: #fff !important; z-index: 999; }
        .vis-item.vis-point:hover .vis-dot { 
            background: var(--accent); 
            border-color: var(--accent);
            transform: scale(1.5);
        }

        .vis-item.vis-selected { color: var(--accent) !important; }
        .vis-item.vis-selected .vis-dot { 
            background: var(--accent) !important; 
            border-color: var(--accent) !important; 
        }

        /* --- SIDE PANEL (Clean) --- */
        #side-panel {
            width: 400px;
            height: 100%;
            background: var(--panel-bg);
            border-left: 1px solid var(--border);
            position: absolute;
            right: -450px; /* Hidden */
            top: 0;
            z-index: 50;
            transition: right 0.3s cubic-bezier(0.2, 0, 0, 1);
            display: flex;
            flex-direction: column;
        }

        #side-panel.open { right: 0; }

        .panel-content {
            padding: 40px;
            overflow-y: auto;
            flex-grow: 1;
        }

        .close-btn {
            position: absolute; top: 20px; right: 20px;
            color: #444; font-size: 1.5rem; cursor: pointer;
            transition: 0.2s;
        }
        .close-btn:hover { color: #fff; }

        .p-title {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: #fff;
            margin-bottom: 5px;
            line-height: 1.1;
        }

        .p-subtitle {
            font-size: 0.9rem;
            color: var(--accent);
            margin-bottom: 30px;
            font-family: 'Inter', sans-serif;
            font-weight: 300;
        }

        .p-section { margin-bottom: 25px; }
        .p-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: #555;
            margin-bottom: 8px;
            display: block;
        }
        .p-text {
            font-size: 0.95rem;
            color: #ccc;
            line-height: 1.6;
        }

        .wiki-link {
            display: inline-block;
            margin-top: 30px;
            color: var(--accent);
            font-size: 0.8rem;
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: 0.2s;
        }
        .wiki-link:hover { border-bottom-color: var(--accent); }

        /* --- LEGEND --- */
        .legend {
            position: absolute; bottom: 20px; left: 20px;
            display: flex; gap: 20px;
            font-size: 0.75rem; color: #666;
            pointer-events: none;
        }
        .legend span { color: var(--accent); margin-right: 5px; }

        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            header { padding: 0 15px; }
            .brand { font-size: 1rem; }
            /* Hide filters on mobile for minimalism */
            .controls select { display: none; }
            #search-results { width: 200px; right: -10px; }
            
            #side-panel {
                width: 100%; height: 70%;
                top: auto; bottom: -100%; right: 0;
                border-left: none; border-top: 1px solid var(--border);
                transition: bottom 0.3s cubic-bezier(0.2, 0, 0, 1);
            }
            #side-panel.open { bottom: 0; right: 0; }
        }
    </style>
</head>

<body>
    <div id="welcome-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#050505; z-index:9999; display:flex; flex-direction:column; justify-content:center; align-items:center; transition: opacity 0.5s;">
        <h1 style="font-family:'Cinzel', serif; font-size:3rem; color:#d4af37; margin-bottom:10px;">INDOSPHERE</h1>
        <p style="font-family:'Inter', sans-serif; color:#666; margin-bottom:30px;">The Archive of Indian Thought</p>
        <button onclick="enterApp()" style="background:transparent; border:1px solid #333; color:#ccc; padding:10px 30px; font-family:'Inter',sans-serif; cursor:pointer; transition:0.2s;">ENTER</button>
    </div>

    <header>
        <div class="brand" onclick="resetView()">INDOSPHERE</div>
        <div class="controls">
            <select id="schoolFilter" onchange="applyFilters()">
                <option value="all">Filter: All</option>
                <option value="Advaita">Advaita</option>
                <option value="Buddhism">Buddhism</option>
                <option value="Jainism">Jainism</option>
                <option value="Nyaya">Nyaya</option>
                <option value="Yoga">Yoga</option>
                <option value="Bhakti">Bhakti</option>
                <option value="Indology">Indology</option>
            </select>
            <div class="search-wrapper">
                <input type="text" id="search" placeholder="Search..." autocomplete="off">
                <div id="search-results"></div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <div id="network"></div>
        <div class="legend">
            <div><span>★</span>Deity</div>
            <div><span>●</span>Person</div>
            <div id="count">0 Nodes</div>
        </div>
        
        <div id="side-panel">
            <div class="close-btn" onclick="closePanel()">×</div>
            <div class="panel-content">
                <div class="p-title" id="p-name"></div>
                <div class="p-subtitle" id="p-meta"></div>
                
                <div class="p-section">
                    <span class="p-label">Significance</span>
                    <div class="p-text" id="p-note"></div>
                </div>

                <div class="p-section" id="sec-works">
                    <span class="p-label">Major Works</span>
                    <div class="p-text" id="p-works"></div>
                </div>

                <div class="p-section" id="sec-lineage">
                    <span class="p-label">Context</span>
                    <div class="p-text" id="p-lineage"></div>
                </div>

                <a href="#" id="p-wiki" target="_blank" class="wiki-link">View on Wikipedia →</a>
            </div>
        </div>
    </div>

    <div id="timeline-container">
        <div id="mytimeline"></div>
    </div>

    <script type="text/javascript">
        // --- 1. DATA (FULL 195+ ENTITIES) ---
        const rawData = [
            // DEITIES
            {id:"Narayana", label:"Narayana", group:"Deity", isDeity:true, note:"The Preserver.", religion:"[Hinduism]"},
            {id:"Shiva", label:"Shiva", group:"Deity", isDeity:true, note:"The Destroyer.", religion:"[Hinduism]"},
            {id:"Brahma", label:"Brahma", group:"Deity", isDeity:true, note:"The Creator.", religion:"[Hinduism]"},
            {id:"Rudra", label:"Rudra", group:"Deity", isDeity:true, note:"Vedic form of Shiva.", religion:"[Hinduism]"},
            {id:"Bhairava", label:"Bhairava", group:"Deity", isDeity:true, note:"Fierce form of Shiva.", religion:"[Hinduism]"},
            {id:"Bhairavi", label:"Bhairavi", group:"Deity", isDeity:true, note:"Tantric Goddess.", religion:"[Hinduism]"},
            {id:"FourKumaras", label:"Four Kumaras", group:"Deity", isDeity:true, note:"Mind-born sons.", religion:"[Hinduism]"},
            {id:"Hiranyagarbha", label:"Hiranyagarbha", group:"Deity", isDeity:true, note:"Cosmic Womb.", religion:"[Hinduism]"},
            {id:"Manjushri", label:"Manjushri", group:"Deity", isDeity:true, note:"Wisdom.", religion:"[Buddhism]"},
            {id:"Vajradhara", label:"Vajradhara", group:"Deity", isDeity:true, note:"Primordial Buddha.", religion:"[Buddhism]"},
            {id:"Surya", label:"Surya", group:"Deity", isDeity:true, note:"Sun God.", religion:"[Hinduism]"},
            {id:"Indra", label:"Indra", group:"Deity", isDeity:true, note:"King of Gods.", religion:"[Hinduism]"},
            {id:"Varuna", label:"Varuna", group:"Deity", isDeity:true, note:"God of Waters.", religion:"[Hinduism]"},

            // HUMANS
            {id:"ShaktiRishi", label:"Shakti", year:-2500, school:"Vedas", note:"Son of Vashishta."},
            {id:"Dhanvantari", label:"Dhanvantari", year:-3000, school:"Ayurveda", note:"God of Medicine."},
            {id:"Vashishta", label:"Vashishta", year:-3000, school:"Vedas", note:"Saptarishi."},
            {id:"Parashara", label:"Parashara", year:-2000, school:"Vedas", note:"Father of Vyasa."},
            {id:"Vyasa", label:"Vyasa", year:-1500, school:"Vedas", note:"Compiler of Vedas."},
            {id:"Shuka", label:"Shuka", year:-1400, school:"Advaita", note:"Son of Vyasa."},
            {id:"Yajnavalkya", label:"Yajnavalkya", year:-850, school:"Vedas", note:"Upanishadic Sage."},
            {id:"Maitreyi", label:"Maitreyi", year:-850, school:"Vedas", note:"Philosopher wife."},
            {id:"Gargi", label:"Gargi", year:-850, school:"Vedas", note:"Vedic debater."},
            {id:"Kapila", label:"Kapila", year:-600, school:"Samkhya", note:"Founder of Samkhya."},
            {id:"Asuri", label:"Asuri", year:-580, school:"Samkhya", note:"Disciple."},
            {id:"Panchashikha", label:"Panchashikha", year:-550, school:"Samkhya", note:"Expanded Samkhya."},
            {id:"Jaimini", label:"Jaimini", year:-300, school:"Mimamsa", note:"Ritualism."},
            {id:"Gautama", label:"Gautama", year:-200, school:"Nyaya", note:"Logic Founder."},
            {id:"Kanada", label:"Kanada", year:-200, school:"Vaisheshika", note:"Atomism."},
            {id:"Patanjali", label:"Patanjali", year:-150, school:"Yoga", note:"Systematized Yoga."},
            {id:"Panini", label:"Panini", year:-500, school:"Grammar", note:"Linguistics."},
            {id:"Chanakya", label:"Chanakya", year:-350, school:"Statecraft", note:"Realpolitik."},
            {id:"Sushruta", label:"Sushruta", year:-600, school:"Medicine", note:"Surgery."},
            {id:"Buddha", label:"Buddha", year:-563, school:"Buddhism", note:"The Awakened One."},
            {id:"Mahavira", label:"Mahavira", year:-540, school:"Jainism", note:"24th Tirthankara."},
            {id:"Makkhali", label:"Makkhali Gosala", year:-500, school:"Ajivika", note:"Fatalism."},
            {id:"Charvaka", label:"Charvaka", year:-600, school:"Charvaka", note:"Materialist."},
            {id:"Brihaspati", label:"Brihaspati", year:-700, school:"Charvaka", note:"Materialist Founder."},
            {id:"Nagarjuna", label:"Nagarjuna", year:150, school:"Buddhism", note:"Madhyamaka."},
            {id:"Aryadeva", label:"Aryadeva", year:200, school:"Buddhism", note:"Disciple."},
            {id:"Dignaga", label:"Dignaga", year:480, school:"Buddhism", note:"Logic."},
            {id:"Huineng", label:"Huineng", year:638, school:"Buddhism", note:"Zen Patriarch."},
            {id:"Milarepa", label:"Milarepa", year:1052, school:"Buddhism", note:"Tibet Yogi."},
            {id:"Bhadrabahu", label:"Bhadrabahu", year:-300, school:"Jainism", note:"Digambara."},
            {id:"Kundakunda", label:"Kundakunda", year:100, school:"Jainism", note:"Philosopher."},
            {id:"Kalidasa", label:"Kalidasa", year:400, school:"Literature", note:"Poet."},
            {id:"Gaudapada", label:"Gaudapada", year:600, school:"Advaita", note:"Paramaguru."},
            {id:"Govinda", label:"Govinda", year:725, school:"Advaita", note:"Guru of Shankara."},
            {id:"Shankara", label:"Adi Shankara", year:788, school:"Advaita", note:"Advaita Founder."},
            {id:"Suresvara", label:"Suresvara", year:800, school:"Advaita", note:"Disciple."},
            {id:"Padmapada", label:"Padmapada", year:800, school:"Advaita", note:"Disciple."},
            {id:"Hastamalaka", label:"Hastamalaka", year:800, school:"Advaita", note:"Disciple."},
            {id:"Totaka", label:"Totaka", year:800, school:"Advaita", note:"Disciple."},
            {id:"Vacaspati", label:"Vacaspati Mishra", year:900, school:"Advaita", note:"Polymath."},
            {id:"Sarvajnatman", label:"Sarvajnatman", year:900, school:"Advaita", note:"Scholar."},
            {id:"Prakasatman", label:"Prakasatman", year:975, school:"Advaita", note:"Vivarana School."},
            {id:"Anandagiri", label:"Anandagiri", year:1260, school:"Advaita", note:"Commentator."},
            {id:"Amalananda", label:"Amalananda", year:1250, school:"Advaita", note:"Scholar."},
            {id:"BharatiTirtha", label:"Bharati Tirtha", year:1328, school:"Advaita", note:"Sringeri."},
            {id:"Vidyaranya", label:"Vidyaranya", year:1350, school:"Advaita", note:"Panchadasi."},
            {id:"Sadananda", label:"Sadananda", year:1450, school:"Advaita", note:"Vedantasara."},
            {id:"Prakashananda", label:"Prakashananda", year:1500, school:"Advaita", note:"Drishti-Srishti."},
            {id:"Madhusudana", label:"Madhusudana", year:1540, school:"Advaita", note:"Advaita Siddhi."},
            {id:"Appayya", label:"Appayya Dikshita", year:1520, school:"Advaita", note:"Polymath."},
            {id:"Dharmaraja", label:"Dharmaraja", year:1600, school:"Advaita", note:"Epistemology."},
            {id:"Nrisimhashrama", label:"Nrisimhashrama", year:1550, school:"Advaita", note:"Commentator."},
            {id:"Brahmananda", label:"Brahmananda", year:1871, school:"Advaita", note:"Jyotirmath."},
            {id:"Karpatri", label:"Karpatri Maharaj", year:1907, school:"Advaita", note:"Dharma Samrat."},
            {id:"Sacchidanandendra", label:"Sacchidanandendra", year:1880, school:"Advaita", note:"Reformer."},
            {id:"Ramana", label:"Ramana Maharshi", year:1879, school:"Advaita", note:"Self Inquiry."},
            {id:"Nisargadatta", label:"Nisargadatta", year:1897, school:"Advaita", note:"I Am That."},
            {id:"Vivekananda", label:"Vivekananda", year:1863, school:"Advaita", note:"Raja Yoga."},
            {id:"Chandrashekhara", label:"Chandrashekhara", year:1892, school:"Advaita", note:"Sringeri."},
            {id:"AbhinavaVidyatirtha", label:"Abhinava Vidyatirtha", year:1917, school:"Advaita", note:"Sringeri."},
            {id:"Nischalananda", label:"Nischalananda", year:1943, school:"Advaita", note:"Puri Peetham."},
            {id:"Achyuta", label:"Achyuta Preksha", year:1200, school:"Dvaita", note:"Guru."},
            {id:"Madhva", label:"Madhvacharya", year:1238, school:"Dvaita", note:"Dvaita Founder."},
            {id:"Padmanabha", label:"Padmanabha", year:1300, school:"Dvaita", note:"Disciple."},
            {id:"Narahari", label:"Narahari", year:1300, school:"Dvaita", note:"Disciple."},
            {id:"Jayatirtha", label:"Jayatirtha", year:1365, school:"Dvaita", note:"Teekacharya."},
            {id:"Vyasatirtha", label:"Vyasatirtha", year:1460, school:"Dvaita", note:"Logician."},
            {id:"Raghavendra", label:"Raghavendra", year:1595, school:"Dvaita", note:"Saint."},
            {id:"Nammalvar", label:"Nammalvar", year:880, school:"Vishishtadvaita", note:"Alvar."},
            {id:"Nathamuni", label:"Nathamuni", year:900, school:"Vishishtadvaita", note:"Acharya."},
            {id:"Yamuna", label:"Yamunacharya", year:917, school:"Vishishtadvaita", note:"Preceptor."},
            {id:"Ramanuja", label:"Ramanuja", year:1017, school:"Vishishtadvaita", note:"Founder."},
            {id:"Desika", label:"Vedanta Desika", year:1268, school:"Vishishtadvaita", note:"Vadakalai."},
            {id:"Pillai", label:"Pillai Lokacharya", year:1205, school:"Vishishtadvaita", note:"Thenkalai."},
            {id:"Vasugupta", label:"Vasugupta", year:800, school:"Kashmir Shaivism", note:"Shiva Sutras."},
            {id:"Somananda", label:"Somananda", year:900, school:"Kashmir Shaivism", note:"Pratyabhijna."},
            {id:"Utpaladeva", label:"Utpaladeva", year:925, school:"Kashmir Shaivism", note:"Architect."},
            {id:"Abhinavagupta", label:"Abhinavagupta", year:950, school:"Kashmir Shaivism", note:"Tantraloka."},
            {id:"Kshemaraja", label:"Kshemaraja", year:1000, school:"Kashmir Shaivism", note:"Disciple."},
            {id:"Lakshmanjoo", label:"Lakshmanjoo", year:1907, school:"Kashmir Shaivism", note:"Modern."},
            {id:"Vatsyayana", label:"Vatsyayana", year:450, school:"Nyaya", note:"Commentator."},
            {id:"Uddyotakara", label:"Uddyotakara", year:600, school:"Nyaya", note:"Logician."},
            {id:"VacaspatiN", label:"Vacaspati (Nyaya)", year:900, school:"Nyaya", note:"Polymath."},
            {id:"Udayana", label:"Udayana", year:984, school:"Nyaya", note:"Theist Logic."},
            {id:"Gangesa", label:"Gangesa", year:1325, school:"Nyaya", note:"Navya-Nyaya."},
            {id:"Raghunatha", label:"Raghunatha", year:1477, school:"Nyaya", note:"Logician."},
            {id:"Gadadhara", label:"Gadadhara", year:1650, school:"Nyaya", note:"Logician."},
            {id:"Shabara", label:"Shabara", year:200, school:"Mimamsa", note:"Commentator."},
            {id:"Kumarila", label:"Kumarila Bhatta", year:700, school:"Mimamsa", note:"Bhatta School."},
            {id:"Prabhakara", label:"Prabhakara", year:700, school:"Mimamsa", note:"Guru School."},
            {id:"Mandana", label:"Mandana Mishra", year:800, school:"Mimamsa", note:"Debater."},
            {id:"IshvaraKrishna", label:"Ishvara Krishna", year:350, school:"Samkhya", note:"Samkhya Karika."},
            {id:"Vijnanabhikshu", label:"Vijnanabhikshu", year:1550, school:"Yoga", note:"Syncretic."},
            {id:"Prashastapada", label:"Prashastapada", year:550, school:"Vaisheshika", note:"Atomism."},
            {id:"Nimbarka", label:"Nimbarka", year:1150, school:"Dvaitadvaita", note:"Founder."},
            {id:"Vallabha", label:"Vallabha", year:1479, school:"Shuddhadvaita", note:"Pushtimarg."},
            {id:"Vidyapati", label:"Vidyapati", year:1352, school:"Literature", note:"Poet."},
            {id:"Jayadeva", label:"Jayadeva", year:1200, school:"Bhakti", note:"Gita Govinda."},
            {id:"Chaitanya", label:"Chaitanya", year:1486, school:"Bhakti", note:"Gaudiya."},
            {id:"Kabir", label:"Kabir", year:1440, school:"Bhakti", note:"Nirguna."},
            {id:"Tulsidas", label:"Tulsidas", year:1532, school:"Bhakti", note:"Ramcharitmanas."},
            {id:"Surdas", label:"Surdas", year:1478, school:"Bhakti", note:"Sur Sagar."},
            {id:"Mirabai", label:"Mirabai", year:1498, school:"Bhakti", note:"Krishna Bhakta."},
            {id:"Andal", label:"Andal", year:750, school:"Bhakti", note:"Alvar."},
            {id:"Tyagaraja", label:"Tyagaraja", year:1767, school:"Music", note:"Trinity."},
            {id:"Muthuswami", label:"Muthuswami", year:1775, school:"Music", note:"Trinity."},
            {id:"SyamaSastri", label:"Syama Sastri", year:1762, school:"Music", note:"Trinity."},
            {id:"AmirKhusrau", label:"Amir Khusrau", year:1253, school:"Literature", note:"Sufi Poet."},
            {id:"RamMohan", label:"Ram Mohan Roy", year:1772, school:"Modern", note:"Brahmo Samaj."},
            {id:"Bankim", label:"Bankim Chandra", year:1838, school:"Literature", note:"Vande Mataram."},
            {id:"Tagore", label:"Tagore", year:1861, school:"Literature", note:"Nobel Laureate."},
            {id:"Aurobindo", label:"Sri Aurobindo", year:1872, school:"Yoga", note:"Integral Yoga."},
            {id:"Ramanujan", label:"Ramanujan", year:1887, school:"Science", note:"Math Genius."},
            {id:"Ambedkar", label:"Ambedkar", year:1891, school:"Modern", note:"Constitution."},
            {id:"Nazrul", label:"Nazrul", year:1899, school:"Literature", note:"Rebel Poet."},
            {id:"Sarat", label:"Sarat Chandra", year:1876, school:"Literature", note:"Novelist."},
            {id:"Madhusudan", label:"Madhusudan", year:1824, school:"Literature", note:"Epic Poet."},
            {id:"Ramakrishna", label:"Ramakrishna", year:1836, school:"Bhakti", note:"Mystic."},
            {id:"CVRaman", label:"CV Raman", year:1888, school:"Science", note:"Nobel Physics."},
            {id:"Bose", label:"JC Bose", year:1858, school:"Science", note:"Plant Science."},
            {id:"SNBose", label:"SN Bose", year:1894, school:"Science", note:"Boson."},
            {id:"Gandhi", label:"Gandhi", year:1869, school:"Modern", note:"Mahatma."},
            {id:"Nivedita", label:"Sister Nivedita", year:1867, school:"Modern", note:"Disciple."},
            {id:"Megasthenes", label:"Megasthenes", year:-350, school:"Indology", note:"Indica."},
            {id:"Faxian", label:"Faxian", year:399, school:"Indology", note:"Pilgrim."},
            {id:"Xuanzang", label:"Xuanzang", year:629, school:"Indology", note:"Pilgrim."},
            {id:"AlBiruni", label:"Al-Biruni", year:973, school:"Indology", note:"Indica."},
            {id:"IbnBattuta", label:"Ibn Battuta", year:1333, school:"Indology", note:"Traveler."},
            {id:"MarcoPolo", label:"Marco Polo", year:1288, school:"Indology", note:"Traveler."},
            {id:"Jones", label:"William Jones", year:1746, school:"Indology", note:"Philology."},
            {id:"Wilkins", label:"Wilkins", year:1749, school:"Indology", note:"Gita Trans."},
            {id:"Prinsep", label:"Prinsep", year:1799, school:"Indology", note:"Ashoka."},
            {id:"Cunningham", label:"Cunningham", year:1814, school:"Indology", note:"ASI."},
            {id:"MaxMuller", label:"Max Muller", year:1823, school:"Indology", note:"Vedas."},
            {id:"Weber", label:"Weber", year:1825, school:"Indology", note:"Scholar."},
            {id:"MonierWilliams", label:"Monier-Williams", year:1819, school:"Indology", note:"Dictionary."},
            {id:"Rajendralal", label:"Rajendralal", year:1822, school:"Indology", note:"Indian Scholar."},
            {id:"Bhandarkar", label:"Bhandarkar", year:1837, school:"Indology", note:"Historian."},
            {id:"Schopenhauer", label:"Schopenhauer", year:1788, school:"Indology", note:"Philosopher."},
            {id:"Tesla", label:"Tesla", year:1856, school:"Indology", note:"Vedantic Physics."},
            {id:"Eliot", label:"TS Eliot", year:1888, school:"Indology", note:"Poet."},
            {id:"Oppenheimer", label:"Oppenheimer", year:1904, school:"Indology", note:"Gita."}
        ];

        const lineages = [
            {s:"Shiva", t:"Vasugupta"}, {s:"Shiva", t:"Shankara"}, {s:"Narayana", t:"Brahma"}, 
            {s:"Brahma", t:"Vashishta"}, {s:"Vashishta", t:"ShaktiRishi"}, {s:"ShaktiRishi", t:"Parashara"},
            {s:"Parashara", t:"Vyasa"}, {s:"Vyasa", t:"Shuka"}, {s:"Shuka", t:"Gaudapada"},
            {s:"Gaudapada", t:"Govinda"}, {s:"Govinda", t:"Shankara"}, {s:"Shankara", t:"Suresvara"},
            {s:"Shankara", t:"Padmapada"}, {s:"Shankara", t:"Totaka"}, {s:"Shankara", t:"Hastamalaka"},
            {s:"Suresvara", t:"Vacaspati"}, {s:"Vacaspati", t:"Sarvajnatman"}, {s:"Padmapada", t:"Prakasatman"},
            {s:"Shankara", t:"Anandagiri"}, {s:"Vacaspati", t:"Amalananda"}, {s:"Shankara", t:"BharatiTirtha"},
            {s:"BharatiTirtha", t:"Vidyaranya"}, {s:"Vidyaranya", t:"Sadananda"}, {s:"Shankara", t:"Madhusudana"},
            {s:"Shankara", t:"Appayya"}, {s:"Shankara", t:"Dharmaraja"}, {s:"Shankara", t:"Nrisimhashrama"},
            {s:"Shankara", t:"Brahmananda"}, {s:"Brahmananda", t:"Karpatri"}, {s:"Karpatri", t:"Nischalananda"},
            {s:"Shankara", t:"Sacchidanandendra"}, {s:"Ramakrishna", t:"Vivekananda"}, {s:"Vivekananda", t:"Nivedita"},
            {s:"Shankara", t:"Chandrashekhara"}, {s:"Chandrashekhara", t:"AbhinavaVidyatirtha"},
            {s:"Narayana", t:"Madhva"}, {s:"Madhva", t:"Padmanabha"}, {s:"Padmanabha", t:"Narahari"},
            {s:"Madhva", t:"Jayatirtha"}, {s:"Jayatirtha", t:"Vyasatirtha"}, {s:"Vyasatirtha", t:"Raghavendra"},
            {s:"Narayana", t:"Nammalvar"}, {s:"Nammalvar", t:"Nathamuni"}, {s:"Nathamuni", t:"Yamuna"},
            {s:"Yamuna", t:"Ramanuja"}, {s:"Ramanuja", t:"Desika"}, {s:"Ramanuja", t:"Pillai"},
            {s:"Vasugupta", t:"Somananda"}, {s:"Somananda", t:"Utpaladeva"}, {s:"Utpaladeva", t:"Abhinavagupta"},
            {s:"Abhinavagupta", t:"Kshemaraja"}, {s:"Abhinavagupta", t:"Lakshmanjoo"},
            {s:"Gautama", t:"Vatsyayana"}, {s:"Udayana", t:"Gangesa"}, {s:"Gangesa", t:"Raghunatha"}, {s:"Raghunatha", t:"Gadadhara"},
            {s:"Buddha", t:"Nagarjuna"}, {s:"Nagarjuna", t:"Aryadeva"}, {s:"Asanga", t:"Vasubandhu"},
            {s:"Vasubandhu", t:"Dignaga"}, {s:"Bodhidharma", t:"Huineng"}, {s:"Padmasambhava", t:"Atisha"},
            {s:"Tsongkhapa", t:"DalaiLama"}, {s:"Mahavira", t:"Bhadrabahu"}, {s:"Bhadrabahu", t:"Kundakunda"},
            {s:"Jaimini", t:"Shabara"}, {s:"Shabara", t:"Kumarila"}, {s:"Kumarila", t:"Mandana"}, {s:"Kumarila", t:"Prabhakara"},
            {s:"Kapila", t:"Asuri"}, {s:"Asuri", t:"Panchashikha"}, {s:"Panchashikha", t:"IshvaraKrishna"}
        ];

        // --- SETUP ---
        const container = document.getElementById('network');
        let allNodes = [];
        let allEdges = [];

        // Color Logic: Gold for Advaita, distinct for others, Grey default
        function getColor(school) {
            if(!school) return "#777";
            if(school.includes("Advaita")) return "#ffaf40";
            if(school.includes("Buddhism")) return "#ff6b6b";
            if(school.includes("Jainism")) return "#4ecdc4";
            if(school.includes("Nyaya") || school.includes("Vaisheshika")) return "#45aaf2";
            if(school.includes("Shaiv")) return "#a55eea";
            if(school.includes("Bhakti")) return "#fed330";
            if(school.includes("Indology")) return "#d1d8e0";
            return "#777";
        }

        const seenIds = new Set();
        rawData.forEach(d => {
            if(seenIds.has(d.id)) return;
            seenIds.add(d.id);
            
            let color = getColor(d.school);
            let size = 15;
            let label = d.label;
            let shape = 'dot';

            if(d.isDeity) {
                color = "#fff"; // Deities are white stars
                shape = 'star';
                size = 25;
            }

            allNodes.push({
                id: d.id,
                label: label,
                color: color,
                size: size,
                shape: shape,
                font: { color: '#fff', face: 'Inter', size: 14, strokeWidth: 3, strokeColor: '#050505' },
                data: d
            });
        });

        lineages.forEach(l => {
            if(seenIds.has(l.s) && seenIds.has(l.t)) {
                allEdges.push({ from: l.s, to: l.t });
            }
        });

        document.getElementById('count').innerText = `${allNodes.length} Nodes`;

        const data = { nodes: new vis.DataSet(allNodes), edges: new vis.DataSet(allEdges) };
        
        const options = {
            nodes: { borderWidth: 0, shadow: false },
            edges: { 
                width: 1, 
                color: { color: '#fff', opacity: 0.1 }, // FAINT LINES
                smooth: { type: 'continuous', roundness: 0.5 }
            },
            physics: {
                enabled: true,
                stabilization: {
                    enabled: true,
                    iterations: 2000, // Pre-calculate everything
                    updateInterval: 50
                },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springLength: 150,
                    springConstant: 0.02
                }
            },
            interaction: { hover: true, tooltipDelay: 100 }
        };

        const network = new vis.Network(container, data, options);

        // FREEZE PHYSICS after load
        network.on("stabilizationIterationsDone", function() {
            network.setOptions({ physics: { enabled: false } });
        });

        // --- INTERACTION ---
        network.on("click", function(params) {
            if(params.nodes.length > 0) {
                const nodeId = params.nodes[0];
                const node = allNodes.find(n => n.id === nodeId);
                openPanel(node.data);

                // ZEN FOCUS MODE
                const connected = network.getConnectedNodes(nodeId);
                const allIds = data.nodes.getIds();
                const updates = allIds.map(id => {
                    const isConnected = (id === nodeId || connected.includes(id));
                    return { 
                        id: id, 
                        color: { opacity: isConnected ? 1 : 0.05 },
                        font: { opacity: isConnected ? 1 : 0 }
                    };
                });
                
                // Show lines only for connected
                const edgeUpdates = data.edges.getIds().map(eId => {
                    const edge = data.edges.get(eId);
                    const isConn = (edge.from === nodeId || edge.to === nodeId);
                    return { id: eId, color: { opacity: isConn ? 0.8 : 0.02 } };
                });

                data.nodes.update(updates);
                data.edges.update(edgeUpdates);

                // Sync Timeline
                if(!node.data.isDeity && node.data.year) {
                    const tItem = timelineData.get({ filter: i => i.personId === nodeId });
                    if(tItem.length) timeline.moveTo(tItem[0].start);
                }

            } else {
                closePanel();
                // Reset
                const allIds = data.nodes.getIds();
                const resets = allIds.map(id => {
                    const original = allNodes.find(n => n.id === id);
                    return { id: id, color: original.color, font: { opacity: 1 } };
                });
                const edgeResets = data.edges.getIds().map(id => ({ id: id, color: { opacity: 0.1 } }));
                data.nodes.update(resets);
                data.edges.update(edgeResets);
            }
        });

        // Cursor
        network.on("hoverNode", function () { document.getElementById('network').style.cursor = "pointer"; });
        network.on("blurNode", function () { document.getElementById('network').style.cursor = "default"; });

        // --- PANEL ---
        function openPanel(d) {
            document.getElementById('p-name').innerText = d.label;
            document.getElementById('p-meta').innerText = d.isDeity ? (d.religion + " • " + d.group) : (d.school + " • " + (d.displayDate || d.year));
            document.getElementById('p-note').innerText = d.note || "No details available.";
            
            // Populate sections based on data availability
            const works = d.work ? d.work + (d.others && d.others.length ? ", " + d.others.join(", ") : "") : "N/A";
            document.getElementById('p-works').innerText = works;
            
            // Lineage logic
            let pLink = lineages.find(l => l.t === d.id);
            document.getElementById('p-lineage').innerText = pLink ? `Connected to ${pLink.s}` : "Independent / Source";

            // Wiki
            const wikiSlug = d.wiki || d.label.replace(/\s+/g, '_');
            document.getElementById('p-wiki').href = `https://en.wikipedia.org/wiki/${wikiSlug}`;

            document.getElementById('side-panel').classList.add('open');
        }

        function closePanel() {
            document.getElementById('side-panel').classList.remove('open');
        }

        function enterApp() {
            document.getElementById('welcome-overlay').style.opacity = 0;
            setTimeout(() => { document.getElementById('welcome-overlay').style.display = 'none'; }, 500);
        }

        function resetView() {
            network.fit({animation: true});
            closePanel();
        }

        // --- SEARCH ---
        const sInput = document.getElementById('search');
        const sResults = document.getElementById('search-results');
        sInput.addEventListener('input', (e) => {
            const val = e.target.value.toLowerCase();
            sResults.innerHTML = '';
            if(val.length < 2) { sResults.style.display = 'none'; return; }
            
            const matches = allNodes.filter(n => n.label.toLowerCase().includes(val));
            if(matches.length) {
                sResults.style.display = 'flex';
                matches.forEach(m => {
                    const div = document.createElement('div');
                    div.className = 'search-item';
                    div.innerHTML = `<span>${m.label}</span><span class="meta">${m.data.school || 'Deity'}</span>`;
                    div.onclick = () => {
                        network.selectNodes([m.id]);
                        network.focus(m.id, {scale: 1.5, animation: true});
                        openPanel(m.data);
                        sResults.style.display = 'none';
                        sInput.value = '';
                    };
                    sResults.appendChild(div);
                });
            } else {
                sResults.style.display = 'none';
            }
        });

        // --- TIMELINE ---
        const timelineData = new vis.DataSet(rawData.filter(x => !x.isDeity && x.year).map((t, i) => ({
            id: i, content: t.label, start: new Date(0).setFullYear(t.year),
            type: 'point', className: 'vis-point', personId: t.id
        })));

        const timeline = new vis.Timeline(document.getElementById('mytimeline'), timelineData, {
            height: '100%', stack: true, margin: { item: 10, axis: 5 }, orientation: 'bottom',
            start: new Date(0).setFullYear(1000), end: new Date(0).setFullYear(2000), zoomMin: 1000 * 60 * 60 * 24 * 365 * 10
        });

        timeline.on('select', (props) => {
            if (props.items.length) {
                const item = timelineData.get(props.items[0]);
                const node = allNodes.find(n => n.id === item.personId);
                if(node) {
                    network.selectNodes([node.id]);
                    network.focus(node.id, {scale: 1.5, animation: true});
                    openPanel(node.data);
                }
            }
        });

        function applyFilters() {
            const sVal = document.getElementById('schoolFilter').value;
            const rVal = document.getElementById('regionFilter').value; // Ignored in simple logic for speed
            
            const visibleNodes = [];
            allNodes.forEach(n => {
                let show = (sVal === 'all' || n.data.school === sVal);
                if(sVal === 'Buddhism' && n.data.school === 'Theravada') show = true; // Simple alias check
                if(show) visibleNodes.push(n);
            });

            data.nodes.clear(); data.edges.clear();
            data.nodes.add(visibleNodes);
            
            // Re-add relevant edges
            const visibleIds = new Set(visibleNodes.map(n => n.id));
            const visibleEdges = allEdges.filter(e => visibleIds.has(e.from) && visibleIds.has(e.to));
            data.edges.add(visibleEdges);
        }
    </script>
</body>
</html>
